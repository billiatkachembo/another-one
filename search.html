<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="theme-color" content="#06c1db">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search Results</title>
<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
/* --- Base Styles --- */
body { margin: 0; font-family: system-ui, sans-serif; background: #f9f9f9; color: #222; transition: background 0.3s, color 0.3s; }
body.dark { background: #111; color: #eee; }
a { text-decoration: none; color: #007bff; transition: color 0.3s; }
body.dark a { color: #66ccff; }
a:hover { text-decoration: underline; }
main { max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
#searchResults p { margin-bottom: 1rem; }
mark { background-color: yellow; }
body.dark mark { background-color: #ffea00; color: #111; }

/* --- Search Panel --- */
.search-panel {
    position: fixed;
    top: 0;
    right: -100%;
    width: 50vw;
    max-width: 350px;
    height: 100%;
    background: #fff;
    box-shadow: -4px 0 12px rgba(0,0,0,0.2);
    backdrop-filter: blur(10px);
    transition: right 0.3s ease, background 0.3s, color 0.3s;
    z-index: 2000;
    padding: 2rem 1.5rem;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
}
body.dark .search-panel { background: #222; color: #eee; }

/* Back button */
.back-btn {
    font-size: 1.5rem;
    background: none;
    border: none;
    cursor: pointer;
    color: #333;
    margin-bottom: 1rem;
    align-self: flex-start;
    transition: color 0.3s;
}
.back-btn:hover { color: #06c1db; }
body.dark .back-btn { color: #eee; }
body.dark .back-btn:hover { color: #66ccff; }

/* Search form */
.search-form { display: flex; gap: 0.5rem; }
.search-form input {
    flex: 1;
    padding: 0.5rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    background: #fff;
    color: #222;
    transition: background 0.3s, color 0.3s, border-color 0.3s;
}
body.dark .search-form input { background: #333; color: #eee; border-color: #555; }
.search-form button {
    padding: 0.5rem 0.8rem;
    border: none;
    border-radius: 6px;
    background: #06c1db;
    color: white;
    cursor: pointer;
    transition: background 0.3s;
}
.search-form button:hover { background: #0499ac; }

/* Overlay */
.search-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.3);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease;
    z-index: 1500;
    cursor: pointer;
}
.search-overlay.active { opacity: 1; visibility: visible; }

/* Search results */
.result-item {
    background: #fff;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    transition: background 0.3s, color 0.3s;
}
body.dark .result-item { background: #222; color: #eee; }
.result-item a { font-weight: bold; color: #007bff; font-size: 1.1rem; }
body.dark .result-item a { color: #66ccff; }
.result-item p { margin-top: 0.5rem; }

/* Header buttons */
.header-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}
.theme-toggle-btn, .open-search-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #333;
    transition: color 0.3s;
}
body.dark .theme-toggle-btn, body.dark .open-search-btn { color: #eee; }
.theme-toggle-btn:hover, .open-search-btn:hover { color: #06c1db; }
body.dark .theme-toggle-btn:hover, body.dark .open-search-btn:hover { color: #66ccff; }

/* Prevent scroll when menu is open */
body.menu-open { overflow: hidden; }

@media(min-width: 768px) {
    .search-panel { width: 30vw; }
    .search-overlay { width: 100vw; }
}
</style>
</head>
<body>

<!-- Search Panel -->
<div class="search-panel" id="search-panel">
    <button type="button" class="back-btn" id="close-search" aria-label="Close Search">
        <i class="fas fa-arrow-left"></i>
    </button>
    <form class="search-form" action="search.html" method="GET" role="search">
        <input type="text" name="q" placeholder="Search..." aria-label="Search" />
        <button type="submit">Search</button>
    </form>
</div>

<!-- Overlay -->
<div class="search-overlay" id="search-overlay"></div>

<!-- Main content -->
<main>
    <div class="header-controls">
        <h1>Search Results</h1>
        <div>
            <button id="open-search-btn" class="open-search-btn" aria-label="Open search panel">
                <i class="fas fa-search"></i>
            </button>
            <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle light/dark theme">
                <i id="theme-icon" class="fas fa-moon"></i>
            </button>
        </div>
    </div>
    <div id="searchResults">
        <p>Loading results...</p>
    </div>
</main>

<script>
    // --- Panel Controls ---
    const panel = document.getElementById("search-panel");
    const overlay = document.getElementById("search-overlay");
    const closeBtn = document.getElementById("close-search");
    const openSearchBtn = document.getElementById("open-search-btn");

    function openPanel() {
        panel.style.right = "0";
        overlay.classList.add("active");
        document.body.classList.add("menu-open");
    }

    function closePanel() {
        panel.style.right = "-100%";
        overlay.classList.remove("active");
        document.body.classList.remove("menu-open");
    }

    openSearchBtn.addEventListener("click", openPanel);
    overlay.addEventListener("click", closePanel);
    closeBtn.addEventListener("click", closePanel);

    // --- Theme Toggle ---
    const themeToggleBtn = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");

    function enableDark() {
        document.body.classList.add('dark');
        themeIcon.classList.replace('fa-moon', 'fa-sun');
        localStorage.setItem('theme', 'dark');
    }

    function disableDark() {
        document.body.classList.remove('dark');
        themeIcon.classList.replace('fa-sun', 'fa-moon');
        localStorage.setItem('theme', 'light');
    }

    themeToggleBtn.addEventListener('click', () => {
        document.body.classList.contains('dark') ? disableDark() : enableDark();
    });

    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') enableDark();
    else if (savedTheme === 'light') disableDark();
    else if (window.matchMedia('(prefers-color-scheme: dark)').matches) enableDark();

    // --- Search Functionality ---
    document.addEventListener("DOMContentLoaded", async () => {
        const searchInput = document.querySelector('.search-form input[name="q"]');
        const searchResultsContainer = document.getElementById("searchResults");
        let contentArray = [];

        async function getSiteContent() {
            try {
                const response = await fetch("index.html");
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, "text/html");
                const sections = doc.querySelectorAll("section");
                const pageContent = [];
                sections.forEach(sec => {
                    const title = sec.querySelector("h2")?.innerText || sec.id;
                    const content = (sec.innerText || "").replace(/\s+/g, " ").trim();
                    if (content.length) pageContent.push({
                        title,
                        text: content,
                        url: `index.html#${sec.id}`
                    });
                });
                return pageContent;
            } catch (err) {
                console.error(err);
                return [];
            }
        }

        contentArray = await getSiteContent();

        function searchContent(query, data) {
            if (!query) return [];
            const term = query.toLowerCase();
            return data.map(item => {
                const idx = item.text.toLowerCase().indexOf(term);
                if (idx !== -1) {
                    const start = Math.max(0, idx - 30);
                    const end = Math.min(item.text.length, idx + 70);
                    const snippet = (start > 0 ? "..." : "") + item.text.substring(start, end) + (end < item.text.length ? "..." : "");
                    return {
                        title: item.title,
                        snippet,
                        url: item.url
                    };
                }
                return null;
            }).filter(Boolean);
        }

        function highlightTerm(text, term) {
            const regex = new RegExp(`(${term})`, "gi");
            return text.replace(regex, "<mark>$1</mark>");
        }

        function showResults(results, query, container) {
            container.innerHTML = "";
            if (query.trim() === "" || results.length === 0) {
                container.innerHTML = `<p style="padding: 10px;">No results found for "${query}".</p>`;
                return;
            }
            results.forEach(res => {
                const div = document.createElement("div");
                div.className = "result-item";
                div.innerHTML = `<a href="${res.url}">${res.title}</a><p>${highlightTerm(res.snippet, query)}</p>`;
                container.appendChild(div);
            });
        }

        function debounce(fn, delay) {
            let timer;
            return function(...args) {
                clearTimeout(timer);
                timer = setTimeout(() => {
                    fn.apply(this, args);
                }, delay);
            };
        }

        const handleSearch = debounce((e) => {
            const query = e.target.value.trim();
            const results = searchContent(query, contentArray);
            showResults(results, query, searchResultsContainer);
        }, 300);

        if (searchInput) {
            searchInput.addEventListener("input", handleSearch);
        }
    });
</script>
</body>
</html>
